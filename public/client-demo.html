<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo - Contract Processor Cliente</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .demo-header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .demo-header h1 {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .demo-header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .demo-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .demo-section h2 {
            margin-top: 0;
            color: #334155;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .demo-examples {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            grid-column: span 2;
            margin-top: 30px;
        }

        .example-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .example-btn {
            padding: 15px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: #f8fafc;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .example-btn:hover {
            border-color: #667eea;
            background: #f0f9ff;
        }

        .example-btn strong {
            display: block;
            color: #334155;
            margin-bottom: 5px;
        }

        .example-btn small {
            color: #64748b;
            font-size: 0.875rem;
        }

        .config-section {
            background: #f1f5f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .config-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            margin-bottom: 10px;
            font-family: monospace;
            font-size: 14px;
        }

        .config-label {
            display: block;
            font-weight: 600;
            color: #475569;
            margin-bottom: 5px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-connected {
            background: #dcfce7;
            color: #16a34a;
        }

        .status-error {
            background: #fef2f2;
            color: #dc2626;
        }

        .integration-code {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .demo-examples {
                grid-column: span 1;
            }

            .demo-header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>ü§ñ Contract Processor</h1>
            <p>Demo del Cliente JavaScript Embebible</p>
            <div>
                <span id="connectionStatus" class="status-badge status-error">‚ùå Desconectado</span>
            </div>
        </div>

        <div class="demo-grid">
            <!-- Configuraci√≥n -->
            <div class="demo-section">
                <h2>‚öôÔ∏è Configuraci√≥n</h2>
                <div class="config-section">
                    <label class="config-label">URL del Backend:</label>
                    <input type="text" id="apiUrl" class="config-input" value="http://localhost:3000" placeholder="https://tu-backend.railway.app">
                    
                    <label class="config-label">API Key:</label>
                    <input type="text" id="apiKey" class="config-input" value="APIKEY_CLIENTE_ABC123_1704067200_ABC123" placeholder="Tu API Key">
                    
                    <button onclick="updateClientConfig()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; width: 100%;">
                        üîÑ Actualizar Configuraci√≥n
                    </button>
                </div>

                <h3>üìã Integraci√≥n WordPress</h3>
                <p style="font-size: 14px; color: #64748b; margin-bottom: 15px;">
                    Copia este c√≥digo en tu p√°gina o post de WordPress:
                </p>
                <div class="integration-code">
&lt;div style="max-width: 800px; margin: 20px auto;"&gt;
    &lt;!-- Copiar contenido de agent-client.html --&gt;
    &lt;script&gt;
        updateConfig({
            apiBaseUrl: '<span id="displayApiUrl">http://localhost:3000</span>',
            apiKey: '<span id="displayApiKey">TU_API_KEY</span>',
            compactMode: true
        });
    &lt;/script&gt;
&lt;/div&gt;
                </div>
            </div>

            <!-- Informaci√≥n del Sistema -->
            <div class="demo-section">
                <h2>üìä Estado del Sistema</h2>
                <div style="margin-bottom: 15px;">
                    <strong>Backend:</strong> <span id="backendStatus">Verificando...</span>
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>API Key:</strong> <span id="apiKeyStatus">Verificando...</span>
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>√öltima Prueba:</strong> <span id="lastTest">Nunca</span>
                </div>
                
                <button onclick="testConnection()" style="background: #16a34a; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; width: 100%; margin-top: 20px;">
                    üîç Probar Conexi√≥n
                </button>

                <h3 style="margin-top: 25px;">üìà Caracter√≠sticas</h3>
                <ul style="font-size: 14px; color: #475569;">
                    <li>‚úÖ Autenticaci√≥n autom√°tica</li>
                    <li>‚úÖ Polling inteligente</li>
                    <li>‚úÖ Manejo de errores</li>
                    <li>‚úÖ Copia al portapapeles</li>
                    <li>‚úÖ Modo compacto</li>
                    <li>‚úÖ 100% embebible</li>
                </ul>
            </div>
        </div>

        <!-- Ejemplos de Texto -->
        <div class="demo-examples">
            <h2>üí° Ejemplos de Texto para Probar</h2>
            <p style="color: #64748b; margin-bottom: 20px;">
                Haz clic en cualquier ejemplo para probarlo autom√°ticamente en el cliente de abajo:
            </p>
            
            <div class="example-buttons">
                <div class="example-btn" onclick="loadExample('contrato_base')">
                    <strong>üìÑ Contrato Base</strong>
                    <small>Contrato de servicios profesionales b√°sico</small>
                </div>
                
                <div class="example-btn" onclick="loadExample('anexo_a')">
                    <strong>üìê Anexo A - Dise√±o</strong>
                    <small>Especificaciones de dise√±o y medidas</small>
                </div>
                
                <div class="example-btn" onclick="loadExample('anexo_b')">
                    <strong>üìù Anexo B - Reuni√≥n</strong>
                    <small>Acta de reuni√≥n y acuerdos</small>
                </div>
                
                <div class="example-btn" onclick="loadExample('anexo_c')">
                    <strong>üîÑ Anexo C - Cambios</strong>
                    <small>Modificaciones y aprobaciones</small>
                </div>
                
                <div class="example-btn" onclick="loadExample('anexo_d')">
                    <strong>‚úÖ Anexo D - Entrega</strong>
                    <small>Entrega final y autorizaci√≥n de pago</small>
                </div>
                
                <div class="example-btn" onclick="loadExample('complejo')">
                    <strong>üè¢ Proyecto Complejo</strong>
                    <small>Proyecto empresarial con m√∫ltiples fases</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Cliente Embebible -->
    <div style="margin-top: 40px;">
        <iframe src="agent-client.html" width="100%" height="700px" style="border: none; border-radius: 16px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);"></iframe>
    </div>

    <script>
        const examples = {
            contrato_base: `Necesito un contrato de servicios profesionales para el proyecto de dise√±o interior de la oficina de TechCorp. El cliente es Mar√≠a Gonz√°lez, representante legal de la empresa. La fecha de inicio es el 15 de febrero de 2024 y el proyecto tiene una duraci√≥n estimada de 3 meses. El presupuesto acordado es de $75,000 USD e incluye consultor√≠a, dise√±o conceptual, selecci√≥n de materiales, supervisi√≥n de obra y entrega final. Se requiere un anticipo del 40% para comenzar los trabajos.`,
            
            anexo_a: `Anexo de especificaciones t√©cnicas para el proyecto de dise√±o interior. La oficina principal tiene 150 metros cuadrados distribuidos en recepci√≥n, 8 oficinas individuales, sala de reuniones y √°rea com√∫n. Se requiere dise√±o de iluminaci√≥n LED, selecci√≥n de mobiliario ergon√≥mico, paleta de colores corporativos (azul y gris), instalaci√≥n de divisiones de cristal templado, y sistema de climatizaci√≥n. Se incluyen planos t√©cnicos, renders 3D y especificaciones de materiales. Medidas exactas de cada espacio ser√°n tomadas la primera semana.`,
            
            anexo_b: `Acta de reuni√≥n celebrada el 8 de febrero de 2024 entre TechCorp y el equipo de dise√±o. Asistentes: Mar√≠a Gonz√°lez (Cliente), Carlos Mendoza (Arquitecto), Ana L√≥pez (Dise√±adora de interiores). Se discuti√≥ el cronograma detallado: Fase 1 - Medici√≥n y dise√±o conceptual (2 semanas), Fase 2 - Selecci√≥n de materiales y compras (3 semanas), Fase 3 - Implementaci√≥n y obra (6 semanas), Fase 4 - Acabados finales (1 semana). Se confirm√≥ el presupuesto de $75,000 con posibilidad de ajustes menores del 10%. La entrega final queda programada para el 15 de mayo de 2024.`,
            
            anexo_c: `Registro de cambios aprobados durante la ejecuci√≥n del proyecto. Cambio #1: Modificaci√≥n en la sala de reuniones - cambio de mesa rectangular por mesa circular, incremento de $2,500. Cambio #2: Actualizaci√≥n del sistema de iluminaci√≥n por tecnolog√≠a smart, incremento de $3,800. Cambio #3: Adici√≥n de sistema de audio integrado en sala de reuniones, incremento de $1,200. Cambio #4: Cambio de pisos de vinilo por pisos de madera engineered en oficinas principales, incremento de $4,500. Presupuesto total actualizado: $87,000. Todos los cambios fueron aprobados por Mar√≠a Gonz√°lez el 15 de marzo de 2024.`,
            
            anexo_d: `Entrega final del proyecto de dise√±o interior TechCorp completada el 12 de mayo de 2024. Se realiz√≥ inspecci√≥n conjunta con resultados satisfactorios. Entregables completados: planos as-built, manual de mantenimiento de sistemas, garant√≠as de mobiliario y equipos, certificados de instalaciones el√©ctricas, reporte fotogr√°fico final. Cliente expres√≥ satisfacci√≥n total con el resultado. Se autoriza el pago del saldo pendiente de $35,000 USD correspondiente al 40% final del proyecto. Per√≠odo de garant√≠a de 12 meses inicia a partir de la fecha de entrega. Proyecto oficialmente cerrado y transferido al cliente.`,
            
            complejo: `Proyecto integral de renovaci√≥n de oficinas corporativas para empresa multinacional de tecnolog√≠a. El cliente es InnovaTech Solutions, representada por el Director de Operaciones Roberto Silva. El proyecto abarca 500 metros cuadrados en dos plantas del edificio principal ubicado en zona financiera. Alcance completo incluye: demolici√≥n de espacios existentes, dise√±o arquitect√≥nico completo, nuevo layout de espacios colaborativos, instalaci√≥n de tecnolog√≠a audiovisual avanzada, mobiliario de alta gama, iluminaci√≥n inteligente, sistema de climatizaci√≥n independiente, y certificaci√≥n LEED. Presupuesto total de $250,000 USD con cronograma de 4 meses. Fecha de inicio: 1 de marzo de 2024. Incluye 3 fases de pago: 50% anticipo, 30% al 60% de avance, 20% contraentrega. Se requiere coordinaci√≥n con otros contratistas y cumplimiento de normativas corporativas estrictas.`
        };

        function loadExample(type) {
            const iframe = document.querySelector('iframe');
            const text = examples[type];
            
            // Enviar mensaje al iframe
            iframe.contentWindow.postMessage({
                action: 'loadText',
                text: text
            }, '*');
        }

        function updateClientConfig() {
            const apiUrl = document.getElementById('apiUrl').value;
            const apiKey = document.getElementById('apiKey').value;
            
            document.getElementById('displayApiUrl').textContent = apiUrl;
            document.getElementById('displayApiKey').textContent = apiKey.substring(0, 20) + '...';
            
            const iframe = document.querySelector('iframe');
            iframe.contentWindow.postMessage({
                action: 'updateConfig',
                config: {
                    apiBaseUrl: apiUrl,
                    apiKey: apiKey
                }
            }, '*');
            
            // Test connection after update
            setTimeout(testConnection, 1000);
        }

        async function testConnection() {
            const apiUrl = document.getElementById('apiUrl').value;
            const apiKey = document.getElementById('apiKey').value;
            
            try {
                document.getElementById('backendStatus').textContent = 'Verificando...';
                document.getElementById('apiKeyStatus').textContent = 'Verificando...';
                
                // Test health endpoint
                const healthResponse = await fetch(`${apiUrl}/health`);
                if (healthResponse.ok) {
                    document.getElementById('backendStatus').innerHTML = '<span style="color: #16a34a;">‚úÖ Conectado</span>';
                    document.getElementById('connectionStatus').className = 'status-badge status-connected';
                    document.getElementById('connectionStatus').textContent = '‚úÖ Conectado';
                } else {
                    throw new Error('Health check failed');
                }
                
                // Test API key with a simple request
                const testResponse = await fetch(`${apiUrl}/api/agent/session/1`, {
                    headers: {
                        'x-api-key': apiKey
                    }
                });
                
                if (testResponse.status === 401) {
                    document.getElementById('apiKeyStatus').innerHTML = '<span style="color: #dc2626;">‚ùå API Key Inv√°lida</span>';
                } else if (testResponse.status === 404) {
                    document.getElementById('apiKeyStatus').innerHTML = '<span style="color: #16a34a;">‚úÖ API Key V√°lida</span>';
                } else {
                    document.getElementById('apiKeyStatus').innerHTML = '<span style="color: #16a34a;">‚úÖ API Key V√°lida</span>';
                }
                
                document.getElementById('lastTest').textContent = new Date().toLocaleTimeString();
                
            } catch (error) {
                console.error('Connection test failed:', error);
                document.getElementById('backendStatus').innerHTML = '<span style="color: #dc2626;">‚ùå Error de conexi√≥n</span>';
                document.getElementById('apiKeyStatus').innerHTML = '<span style="color: #64748b;">‚è∏Ô∏è No verificada</span>';
                document.getElementById('connectionStatus').className = 'status-badge status-error';
                document.getElementById('connectionStatus').textContent = '‚ùå Error';
                document.getElementById('lastTest').textContent = 'Error: ' + new Date().toLocaleTimeString();
            }
        }

        // Listen for messages from iframe
        window.addEventListener('message', function(e) {
            if (e.data.action === 'contractProcessed') {
                console.log('Contract processed in iframe:', e.data);
                // Could show notification or update demo stats
            }
        });

        // Initial connection test
        window.addEventListener('load', function() {
            setTimeout(testConnection, 2000);
        });
    </script>
</body>
</html>